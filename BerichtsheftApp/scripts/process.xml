<project name="Berichtsheft" basedir=".." default="pipe">
	<description>
    This is an ant file for performing Berichtsheft specific tasks.
	</description>
	
	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
	  <classpath>
		<pathelement location="${ant.home}/lib/ant-contrib-1.0b3.jar"/>
	  </classpath>
	</taskdef>
		
  	<property file="berichtsheft.properties"/>
	<property name="debug.out" location="/tmp/debug.out" />
	<property name="params.xml" location="scripts/params.xml" />
	<property name="content.xml" location="scripts/content.xml" />
	<property name="content.xsl" location="scripts/content.xsl" />
	<property name="control.xsl" location="scripts/control.xsl" />
	<property name="geometry.xsl" location="scripts/geometry.xsl" />
	<property name="geometry.html" location="/tmp/temp.html" />
	<property name="src-dir" location="src" />
	<property name="bin-dir" location="bin" />
		
    <path id="project.class.path">
    	<pathelement location="${bin-dir}/"/>
		<fileset dir=".jedit/jars">
			<exclude name="BerichtsheftPlugin.jar"/>
			<filename name="*.jar" />
		</fileset>
    </path>
		    	
	<target name="compile">
		<javac includeantruntime="false" 
			srcdir="${src-dir}"
			destdir="${bin-dir}">
			<classpath refid="project.class.path" />
		</javac>
	</target>
    
    <target name="NotePicker">
        <java fork="true" spawn="true" classname="com.applang.berichtsheft.ui.components.NotePicker">
			<classpath refid="project.class.path" />
        </java>
    </target>
	
	<target name="integrate.weathers">
		<exec executable = "bash">
			<arg value="scripts/process.sh" />
			<arg value="integrate_weathers" />
		</exec>
	</target>
    
    <target name="start.echo">
        <java fork="true" spawn="true" classname="echo.MyEchoServer">
			<classpath>
		    	<pathelement location="${bin-dir}/"/>
            </classpath>
        </java>
    </target>
    
    <target name="stop.echo">
        <java fork="true" spawn="true" classname="echo.MyEchoServer">
			<classpath>
		    	<pathelement location="${bin-dir}/"/>
            </classpath>
        	<arg value=""/>
        	<arg value="-no"/>
        </java>
	</target>
		    	
	<target name="init">
		<touch file="/tmp/control.xml"/>
	</target>
		    	
	<target name="test.debug" depends="init">
		<delete file="/tmp/temp.xml" />
		<xslt in="/tmp/control.xml" out="/tmp/temp.xml" style="scripts/debug.xsl" classpathref="project.class.path">
		</xslt>
	</target>
	    	
	<target name="locate.ids" depends="init">
		<xslt in="/tmp/control.xml" out="/tmp/content.xml" style="${content.xsl}" classpathref="project.class.path">
			<param name="inputfile" expression="${content.xml}"/>
			<param name="control" expression="-1"/>
		</xslt>
		<antcall target="odt.update" />
	</target>
		    	
	<target name="odt.update">
		<zip destfile="Dokumente/Tagesberichte.odt"
			basedir="/tmp"
			includes="content.xml"
			update="true"
		/>
	</target>
		    	
	<target name="pipe.1" depends="init">
		<delete file="/tmp/control.xml"/>
		<xslt in="${params.xml}" out="/tmp/control.xml" style="${control.xsl}" classpathref="project.class.path">
			<param name="debug" expression="no"/>
		</xslt>
	</target>
	    	
	<target name="pipe.2">
		<delete file="/tmp/content.xml"/>
		<xslt in="/tmp/control.xml" out="/tmp/content.xml" style="${content.xsl}" classpathref="project.class.path">
			<param name="inputfile" expression="${content.xml}"/>
			<param name="debug" expression="no"/>
		</xslt>
		<antcall target="odt.update" />
	</target>
		    	
	<target name="pipe" depends="pipe.1, pipe.2" />
	    	
	<target name="geometry.1">
		<delete file="${geometry.html}" />
		<xslt in="${content.xml}" out="${geometry.html}" style="${geometry.xsl}" classpathref="project.class.path">
			<param name="mode" expression="1"/>
			<param name="debug" expression="no"/>
		</xslt>
	</target>
	    	
	<target name="geometry.3">
		<delete file="/tmp/debug.out" />
		<ac:for param="file" xmlns:ac="antlib:net.sf.antcontrib">
			<path>
				<fileset dir="/tmp/berichtsheft" includes="*.html"/>
			</path>
			<ac:sequential>
				<antcall target="geometry.2">
					<param name="controlfile" value="@{file}"/>
				</antcall>
			</ac:sequential>
		</ac:for>
	</target>
	    	
	<target name="geometry.2">
		<echo message="${controlfile}" />
		<delete file="/tmp/content.xml" />
		<xslt in="${content.xml}" out="/tmp/content.xml" style="${geometry.xsl}" classpathref="project.class.path">
			<param name="controlfile" expression="${controlfile}"/>
			<param name="debug" expression="no"/>
		</xslt>
	</target>
		    	
	<target name="geometry" depends="geometry.1">
		<antcall target="geometry.3" />
	</target>
</project>
